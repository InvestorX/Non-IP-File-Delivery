# 技術仕様書

## 概要

Non-IP File Delivery システムの詳細な技術仕様について説明します。

## アーキテクチャ

### システム構成
- **NonIPFileDelivery**: メインサービスアプリケーション
- **NonIPConfigTool**: 設定管理ツール（コンソール版）
- **NonIPWebConfig**: Web設定インターフェース
- **NonIPPerformanceTest**: パフォーマンステストツール
- **NonIPLoadTest**: 負荷テストツール

### 技術スタック
- **.NET 8**: フレームワーク
- **C#**: プログラミング言語
- **Npcap**: Raw Ethernetパケット処理（要セットアップ）
- **ClamAV**: ウイルススキャン（要インストール）

## 独自プロトコル仕様

### Ethernetフレーム構造
```
+------------------+------------------+------------------+
| MAC Header (14B) | Custom Header    | Payload          |
+------------------+------------------+------------------+
| CRC-32 (4B)      |
+------------------+
```

### カスタムヘッダー仕様
- **EtherType**: 0x88B5-0x88B6
- **Version**: プロトコルバージョン (1 byte)
- **Type**: パケットタイプ (1 byte)
- **Sequence**: シーケンス番号 (4 bytes)
- **Length**: ペイロード長 (4 bytes)

## 設定ファイル仕様

### config.ini
基本的な動作設定を管理するファイルです。

### security_policy.ini
セキュリティポリシーを定義するファイルです。

## API仕様

### Web設定API
- `GET /api/config`: 設定取得
- `POST /api/config`: 設定保存
- `GET /api/status`: システムステータス取得

## パフォーマンス要件

| 項目 | 要件 | 測定方法 |
|------|------|----------|
| スループット | 最低 2Gbps | NonIPPerformanceTest.exe |
| レイテンシ | 最大 10ms | NonIPPerformanceTest.exe |
| 同時接続 | 最大 100台 | NonIPLoadTest.exe |
| メモリ使用量 | 最大 8GB | システムモニタリング |

## セキュリティ仕様

### 暗号化
- **アルゴリズム**: AES-256-GCM
- **キー長**: 256 bit
- **適用範囲**: カスタムEthernetフレームペイロード部分

### ウイルススキャン
- **エンジン**: ClamAV
- **タイムアウト**: 5000ms（設定可能）
- **スキャン対象**: 転送ファイル全体

## エラーハンドリング

### エラーコード
- `0`: 正常終了
- `1`: 一般的なエラー
- `2`: 設定エラー
- `3`: ネットワークエラー
- `4`: セキュリティエラー

## ログ仕様

### ログレベル
- **Debug**: 詳細なデバッグ情報
- **Info**: 一般的な情報
- **Warning**: 警告
- **Error**: エラー

### ログ出力先
- コンソール
- ファイル（logs/NonIP-YYYY-MM-DD.log）